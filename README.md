# Проектная работа "Веб-ларек"
https://github.com/aldizza/web-larek-frontend

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

IProduct - интерфейс для описания карточки товара.\
Этот интерфейс описывает базовую структуру объекта товара. Он будет использоваться для хранения основной информации о товаре, такой как уникальный идентификатор товара (id), описание (description:), изображение (image), название(title), категория (category) и цена (price). Этот интерфейс будет использоваться для типизации данных о товарах, которые получаем из API.

```
IOrder - интерфейс для описания заказа.\
Этот интерфейс описывает структуру заказа. Он включает информацию о способе оплаты (payment), контактные данные покупателя (email, номер телефона), адрес доставки (address), общую стоимость заказа (total) и список идентификаторов товаров (items).

```
IAppState - интерфейс для типизации состояния приложения

```
type CategoryProperty - ограничивает значения, которые может принемать поле "category" (string literal types).

```
ISettings -  описывает структуру объекта настроек, который содержит настройки для различных категорий.

```
IModal - интерфейс модального окна.

```
type PaymentMethod - тип оплаты заказа

```
type TPaymentForm - тип для заказа с формой способа оплаты и адреса

```
type TContactsForm - тип для заказа с формой почты и телефона

```
type TOrderField - объединение TContactsForm и TPaymentForm для валидации.

```
type FormErrors - тип используется для представления ошибок валидации формы на основе ключей из IOrder.

```
IOrderResult - интерфейс представляет собой объект, который содержит информацию об id и сумме заказа

```

## Архитектура приложения

Приложение разбито на слои согласно парадигме MVP: базовые классы, данные и представления (отображения или View). В приложении используется событийно-ориентированный подход. Презентер содержит обработчики событий, которые генерируются компонентами других слоев. Слой Presenter не выделяется в отдельные классы и будет реализован в index.ts.

### Базовый код

#### Класс Api
Предоставляет интерфейс для выполнения HTTP-запросов GET и POST к указанному базовому URL. 
Методы:
- `get` - отправляет GET-запрос на указанный URI;
- `post` - отправляет POST-запрос на указанный URI с предоставленными данными.

#### Класс IWebLarekAPI
Класс IWebLarekAPI расширяет класс Api и реализует интерфейс IWebLarekAPI
Методы:
- `getProductItem()` - получаем конкретный продукт по его id и добавляем CDN к его изображению;
- `getProductList()` - получаем список продуктов и добавляем CDN к изображению каждого продукта;
- `orderProducts` - отправляем заказ продуктов на сервер и возвращаем результат заказа;


#### Класс "Component"
Этот базовый компонент представляет собой абстрактный класс для создания компонентов, управляющих DOM-элементами.
Методы:
- `toggleClass` - переключает CSS-класс;
- `setText` - установливает текстовое содержимое;
- `setDisabled` - изменяет статус блокировки;
- `setHidden` - скрывает HTML-элемент;
- `setVisible` - показывает HTML-элемент;
- `setImage` - установливает изображение с алтернативным текстом;
- `render` - возвращает корневой DOM-элемент.

#### Класс "EventEmitter"
Реализует интерфейс IEvents и обеспечивает работу событий. Функции брокера события: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события».
Методы:
- `on` - устанавливает обработчик на указанное событие;
- `off` - удаляет обработчик с указанного события;
- `emit` - инициирует событие с указанным именем и данными;
- `onAll` - устанавливает обработчик, который будет вызываться для всех событий;
- `offAll` - cбрасывает все обработчики событий;
- `trigger` - cоздает функцию-триггер, которая генерирует событие при вызове.

#### Класс "Model"
Абстрактный класс, который служит основой для создания моделей данных, обобщенного типа `T`.\
Конструктор в классе Model<T> выполняет инициализацию объекта на основе переданных данных и сохраняет ссылку на объект управления событиями (events).\
Методы:
- `emitChanges` - служит для отправки событий об изменениях объекта модели.


### Слой данных. Классы и описание модели данных

#### Класс "AppState"
Класс представляет модельное представление состояния приложения с методами для управления каталогом продуктов (catalog), корзиной(basket), предпросмотром продуктов (preview), заказом (order) и ошибками формы (formErrors).
Методы:
- `setCatalog` - устанавливает новый каталог продуктов, конвертируя каждый элемент массива items в экземпляр ProductItem и сохраняя их в this.catalog. Затем вызывает метод emitChanges для оповещения об изменении;
Методы для управления корзиной:
- `setPreview` - устанавливает выбранный продукт в предпросмотре, обновляя this.preview и отправляя событие preview:changed;
- `toggleBasketCard` - переключает состояние продукта в корзине: добавляет его, если он отсутствует, и удаляет, если присутствует;
- `addCardToBasket` - добавляет продукт в корзину и отправляет событие basket:changed;
- `removeCard` - удаляет продукт из корзины и отправляет событие basket:changed;
- `setImage` - установливает изображение с алтернативным текстом;
- `getCardIndex` - возвращает id продукта. Этот метод используется для отображения информации о положении продукта в корзине;
Методы для управления заказом:
- `setOrderPayment` - устанавливает способ оплаты в объекте order, который представляет информацию о заказе;
- `setOrderAddress` - используется для установки или обновления значения адреса доставки (address) в объекте order;
- `setOrderPhone` - обновляет номер телефона в объекте order;
- `setOrderEmail` - обновляет адрес электронной почты в объекте order;
- `setOrderField` - устанавливает поле заказа по указанному ключу и запускает валидацию заказа;
- `setBasketToOrder - устанавливает выбранные элементы корзины в объект заказа order.items и обновляет общую стоимость заказа;
Дополнительные методы:
- `getButtonStatus` - возвращает текст для кнопки в зависимости от наличия продукта в корзине и его цены;
- `getTotalCount` - вычисляет общую стоимость товаров в корзине;
- `validateOrder` - проверяет правильное заполнение (email, phone, address, payment) и обновляет ошибки формы 
- `clearOrder` - очищает данные заказа;
- `clearBasket` - очищает корзину;


### Слой представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.\

#### Класс Basket
Класс наследуется от базового класса Component<IBasketView>. Этот класс управляет отображением корзины с добавленными товарами.\
Методы:
- `sum` - устанавливает текст элемента _total, отображающий общую стоимость товаров в корзине;
- `items` - устанавливает содержимое корзины;
- `selected` - Управляет состоянием кнопки в зависимости от наличия выбранных элементов;
- `total` - Устанавливает текст элемента _total, отображающий общую стоимость товаров в корзине.

#### Класс Form
Класс Form<T> расширяет функциональность базового компонента Component<IFormState> и предоставляет инструменты для работы с HTML-формами.\
Этот класс управляет состоянием формы, обработкой ввода и отправки формы, а также обработкой ошибок.
Поля класса:
- `_submit: HTMLButtonElement` - кнопка "Далее".
- `_errors: HTMLElement` - обьект хранящий все элементы для вывода ошибок под полями формы.
Методы:
- `onInputChange` - обрабатывает изменения ввода в форме. При изменении значения поля формы вызывает событие с информацией о поле и его новом значении;
- `valid` - устанавливает состояние валидности формы. Если данные введены верно, кнопка отправки активируется, если нет — деактивируется;
- `setValid` - изменяет состояние кнопки "Далее";
- `errors` -  устанавливает текст ошибок в элементе _errors;
- `render` - обновляет отображение формы в соответствии с текущим состоянием, переданным ему в виде аргумента. О бновляет валидность формы и ошибки, а также присваивает значения полям формы

#### класс Modal 
Этот класс представляет модальное окно, наследуемое от базового компонента.
Поля класса:
- `_closeButton` - кнопка для закрытия модального окна;
- `_content` - rонтейнер для содержимого модального окна.
Методы: 
- `set content(value: HTMLElement)` - метод для установки содержимого модального окна; 
- `openModal(): void` - метод для открытия модального окна, добавляет CSS-класс для отображения и генерирует событие открытия.
- `closeModal(): void` - метод для закрытия модального окна, удаляет CSS-класс, очищает содержимое и генерирует событие закрытия.
- `render(element: HTMLElement): void` - метод для рендеринга модального окна.

#### класс Order
Класс Order наследуется от класса Form<TPaymentForm> и представляет собой форму заказа с выбором способа оплаты и адреса доставки.
Поля класса:
- `buttonOnline` - кнопка для выбора онлайн-оплаты;
- `buttonCOD` - нопка для выбора оплаты при доставке. COD- cash on delivery;
- `_address` - поле ввода адреса доставки.
Конструктор: Инициализирует форму, добавляет обработчики событий для кнопок выбора способа оплаты.
Методы:
- `set address` - устанавливает значение поля адреса доставки;
- `togglePayment` - переключает активное состояние кнопок выбора способа оплаты;
- `resetButtonState` - сбрасывает состояние кнопок выбора способа оплаты.

#### класс Contacts
Класс Contacts наследуется от класса Form<TContactsForm> и представляет форму для ввода контактной информации (email и телефон).
Поля класса: 
- `_email` - поле ввода email;
- `_phone` - поле ввода номера телефона.
Методы:
Класс Contacts наследует методы от базового класса Form<TContactsForm>

#### класс Success
Класс Success наследуется от базового класса Component<ISuccess> и предназначен для отображения сообщения об успешном выполнении заказа. Этот компонент включает элементы для отображения описания и кнопки закрытия, а также предоставляет метод для обновления текстового содержимого описания.
Поля класса:
- `close` - элемент для кнопки закрытия сообщения об успехе;
- `_description` - элемент для отображения описания успешного заказа.
Методы:
Класс Success наследует методы из базового класса Component.

#### класс Card
Класс Card наследуется от Component<IProduct> и имеет следующие защищенные поля:
- `_description` - описание;
- `_image` - изображение;
- `_category` - категория;
- `_price` - цена;
- `_button` - кнопка. 
Методы:
- `set i-d(value: string)` - устанавливает значение ID для контейнера;
- `get id(): string` - возвращает значение ID контейнера;
- `set title(value: string)` - устанавливает текст заголовка;
- `get title(): string` - возвращает текст заголовка;
- `set image(value: string)` - устанавливает источник изображения;
- `set disabled(value: boolean)` - устанавливает состояние кнопки (активна/неактивна);
- `set price(value: number | null)` - устанавливает текст цены. Если цена равна null, то устанавливается текст "Бесценно";
- `set category(value: CategoryProperty)` - устанавливает текст категории и добавляет соответствующий класс;
- `set button(value: string)` - устанавливает текст кнопки (добавить в корзину/убрать из корзины).

#### Класс ProductItem
Класс ProductItem наследуется от Card и имеет дополнительное защищенное поле _description. Сеттер `description` устанавливает текстовое содержание HTML-элемента, представляющего описание, в соответствии со значением параметра value
Метод:
- `set description(value: string)` - устанавливает текст описания.

#### Класс ProductItemPreview
Класс ProductItemPreview  наследует свойства и методы от класса Card. Защищенное свойство `description`, которое будет содержать ссылку на HTML-элемент, представляющий описание.
Метод:
- `set description(value: string)` - устанавливает текстовое содержание HTML-элемента, представляющего описание, в соответствии со значением параметра value.

#### Класс BasketCard
Класс BasketCard наследует свойства и методы от класса Card.
Поля:
- `_index` - защищенное свойство типа HTMLElement, представляющее индекс элемента корзины;
- `_title` - защищенное свойство типа HTMLElement, представляющее заголовок элемента корзины (в коде не используется и не инициализируется);
- `_deleteButton` - защищенное свойство типа HTMLButtonElement, представляющее кнопку удаления элемента корзины.
Метод:
- `set index` - устанавливает текстовое содержание HTML-элемента _index в соответствии со значением параметра value.

#### Класс Page
Класс Page наследует свойства и методы от класса Component.
Поля:
- `_counter` - защищенное свойство типа HTMLElement, представляющее счетчик товаров в корзине;
- `_catalog` - защищенное свойство типа HTMLElement, представляющее каталог товаров;
- `_wrapper` - защищенное свойство типа HTMLElement, представляющее обертку страницы;
- `_basket` - защищенное свойство типа HTMLElement, представляющее элемент корзины.
Методы:
- `set catalog` - устанавливает содержимое элемента _catalog в соответствии с массивом items, заменяя текущих дочерних элементов на новые;
- `set counter` - устанавливает текстовое содержание элемента _counter в соответствии со значением value, преобразованным в строку;
- `set locked` - управляет классом page__wrapper_locked у элемента _wrapper, добавляя или удаляя его в зависимости от значения value.


*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами моделями данных)*

- `items:changed` - происходит обновление списка продуктов;
- `card:select` - открытие карточки и блокировка интерфейса;
- `card:addToBasket` - отправка карточки в корзину;
- `basket:open` - открытие корзины;
- `basket:changed` - обновление интерфейса корзины;
- `order:open` - открытие формы заказа;
- `order:changed` - изменения в заказе;
- `order.address:change` - 
- `/contacts\.(phone|email):change/` - 
- `formErrors:changed` - 
- `order:submit` - подтверджение формы оплаты;
- `contacts:submit` - подтверджение формы контактов;
