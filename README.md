# Проектная работа "Веб-ларек"
https://github.com/aldizza/web-larek-frontend

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

IProduct - интерфейс для описания карточки товара.\
Этот интерфейс описывает базовую структуру объекта товара. Он будет использоваться для хранения основной информации о товаре, такой как уникальный идентификатор товара (id), описание (description:), изображение (image), название(title), категория (category) и цена (price). Этот интерфейс будет использоваться для типизации данных о товарах, которые получаем из API.

```
IOrder - интерфейс для описания заказа.\
Этот интерфейс описывает структуру заказа. Он включает информацию о способе оплаты (payment), контактные данные покупателя (email, номер телефона), адрес доставки (address), общую стоимость заказа (total) и список идентификаторов товаров (items).

```
IAppState - интерфейс для типизации состояния приложения

```
type CategoryProperty - ограничивает значения, которые может принемать поле "category" (string literal types).

```
ISettings -  описывает структуру объекта настроек, который содержит настройки для различных категорий.

```
IModal - интерфейс модального окна.

```
type PaymentMethod - тип оплаты заказа

```
type TPaymentForm - тип для заказа с формой способа оплаты и адреса

```
type TContactsForm - тип для заказа с формой почты и телефона

```
type TOrderField - объединение TContactsForm и TPaymentForm для валидации.

```
type FormErrors - тип используется для представления ошибок валидации формы на основе ключей из IOrder.

```
IOrderResult - интерфейс представляет собой объект, который содержит информацию об id и сумме заказа

```

## Архитектура приложения

Приложение разбито на слои согласно парадигме MVP: базовые классы, данные и представления (отображения или View). В приложении используется событийно-ориентированный подход. Презентер содержит обработчики событий, которые генерируются компонентами других слоев. Слой Presenter не выделяется в отдельные классы и будет реализован в index.ts.

### Базовый код

#### Класс Api
Предоставляет интерфейс для выполнения HTTP-запросов GET и POST к указанному базовому URL. 
Методы:
- `get` - отправляет GET-запрос на указанный URI;
- `post` - отправляет POST-запрос на указанный URI с предоставленными данными.

#### Класс "EmitterEvent"
Реализует интерфейс IEvents и обеспечивает работу событий. Функции брокера события: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события».
Методы:
- `on` - устанавливает обработчик на указанное событие;
- `off` - удаляет обработчик с указанного события;
- `emit` - инициирует событие с указанным именем и данными;
- `onAll` - устанавливает обработчик, который будет вызываться для всех событий;
- `offAll` - cбрасывает все обработчики событий;
- `trigger` - cоздает функцию-триггер, которая генерирует событие при вызове.

#### Класс "Component"
Этот базовый компонент представляет собой абстрактный класс для создания компонентов, управляющих DOM-элементами.
Методы:
- `toggleClass` - переключает CSS-класс;
- `setText` - установливает текстовое содержимое;
- `setDisabled` - изменяет статус блокировки;
- `setHidden` - скрывает HTML-элемент;
- `setVisible` - показывает HTML-элемент;
- `setImage` - установливает изображение с алтернативным текстом;
- `render` - возвращает корневой DOM-элемент.


#### Класс "Model"
Абстрактный класс, который служит основой для создания моделей данных, обобщенного типа `T`.\
Конструктор в классе Model<T> выполняет инициализацию объекта на основе переданных данных и сохраняет ссылку на объект управления событиями (events).\
Методы:
- `emitChanges` - служит для отправки событий об изменениях объекта модели.


### Слой данных. Классы и описание модели данных

#### Класс "AppState"
Класс представляет модельное представление состояния приложения с методами для управления каталогом продуктов (catalog), корзиной(basket), предпросмотром продуктов (preview), заказом (order) и ошибками формы (formErrors).
Методы:
- `setCatalog` - устанавливает новый каталог продуктов, конвертируя каждый элемент массива items в экземпляр ProductItem и сохраняя их в this.catalog. Затем вызывает метод emitChanges для оповещения об изменении;
Методы для управления корзиной:
- `setPreview` - устанавливает выбранный продукт в предпросмотре, обновляя this.preview и отправляя событие preview:changed;
- `toggleBasketCard` - переключает состояние продукта в корзине: добавляет его, если он отсутствует, и удаляет, если присутствует;
- `addCardToBasket` - добавляет продукт в корзину и отправляет событие basket:changed;
- `removeCard` - удаляет продукт из корзины и отправляет событие basket:changed;
- `setImage` - установливает изображение с алтернативным текстом;
- `getCardIndex` - возвращает id продукта. Этот метод используется для отображения информации о положении продукта в корзине;
Методы для управления заказом:
- `setOrderPayment` - устанавливает способ оплаты в объекте order, который представляет информацию о заказе;
- `setOrderAddress` - используется для установки или обновления значения адреса доставки (address) в объекте order;
- `setOrderPhone` - обновляет номер телефона в объекте order;
- `setOrderEmail` - обновляет адрес электронной почты в объекте order;
- `setOrderField` - устанавливает поле заказа по указанному ключу и запускает валидацию заказа;
- `setBasketToOrder - устанавливает выбранные элементы корзины в объект заказа order.items и обновляет общую стоимость заказа;
Дополнительные методы:
- `getButtonStatus` - возвращает текст для кнопки в зависимости от наличия продукта в корзине и его цены;
- `getTotalCount` - вычисляет общую стоимость товаров в корзине;
- `validateOrder` - проверяет правильное заполнение (email, phone, address, payment) и обновляет ошибки формы 
- `clearOrder` - очищает данные заказа;
- `clearBasket` - очищает корзину;


### Слой представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.\

#### Класс Basket
Класс наследуется от базового класса Component<IBasketView>. Этот класс управляет отображением корзины с добавленными товарами.\
Методы:
- `sum` - устанавливает текст элемента _total, отображающий общую стоимость товаров в корзине;
- items - устанавливает содержимое корзины;
- selected - Управляет состоянием кнопки в зависимости от наличия выбранных элементов;
- total - Устанавливает текст элемента _total, отображающий общую стоимость товаров в корзине.

#### Класс Form
Класс Form<T> расширяет функциональность базового компонента Component<IFormState> и предоставляет инструменты для работы с HTML-формами.\
Этот класс управляет состоянием формы, обработкой ввода и отправки формы, а также обработкой ошибок.
Поля класса:
- _submit: HTMLButtonElement - кнопка "Далее".
- _errors: HTMLElement; - обьект хранящий все элементы для вывода ошибок под полями формы.
Методы:
- onInputChange - обрабатывает изменения ввода в форме. При изменении значения поля формы вызывает событие с информацией о поле и его новом значении;
- valid - устанавливает состояние валидности формы. Если данные введены верно, кнопка отправки активируется, если нет — деактивируется;
- setValid - изменяет состояние кнопки "Далее";
- errors -  устанавливает текст ошибок в элементе _errors;
- render - обновляет отображение формы в соответствии с текущим состоянием, переданным ему в виде аргумента. О бновляет валидность формы и ошибки, а также присваивает значения полям формы

#### класс Modal 
Родительский класс. Позволяет вынести общий функционал для всех модальных окон. Устанавливает слушатель на кнопку-крестик и по клику вне модального окна для закрытия попапа. Конструктор принемает селектор, при помощи которого будет идентефицировано модальное окно и `EmitterEvent` для инициации событий.\
Методы: 
- openModal(): void - открывает модальное окно;
- closeModal(): void - закрывает модальное окно;
- render(element: HTMLElement): void - метод для рендеринга модального окна;

#### класс Order
Класс Order наследуется от класса Form<TPaymentForm> и представляет собой форму заказа с выбором способа оплаты и адреса доставки.
Поля класса:
- buttonOnline - кнопка для выбора онлайн-оплаты;
- buttonCOD - нопка для выбора оплаты при доставке. COD- cash on delivery;
- _address - поле ввода адреса доставки.
Конструктор: Инициализирует форму, добавляет обработчики событий для кнопок выбора способа оплаты.
Методы:
- set address - устанавливает значение поля адреса доставки;
- togglePayment - переключает активное состояние кнопок выбора способа оплаты;
- resetButtonState - сбрасывает состояние кнопок выбора способа оплаты.

#### класс Contacts
Класс Contacts наследуется от класса Form<TContactsForm> и представляет форму для ввода контактной информации (email и телефон).
Поля класса: 
- _email - поле ввода email;
- _phone - поле ввода номера телефона.
Методы:
Класс Contacts наследует методы от базового класса Form<TContactsForm>

#### класс Success
Класс Success наследуется от базового класса Component<ISuccess> и предназначен для отображения сообщения об успешном выполнении заказа. Этот компонент включает элементы для отображения описания и кнопки закрытия, а также предоставляет метод для обновления текстового содержимого описания.
Поля класса:
- close - элемент для кнопки закрытия сообщения об успехе;
- _description - элемент для отображения описания успешного заказа.
Методы:
Класс Success наследует методы из базового класса Component.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами моделями данных)*

- `items:changed` - происходит обновление списка продуктов;
- `card:select` - открытие карточки и блокировка интерфейса;
- `card:addToBasket` - отправка карточки в корзину;
- `basket:open` - открытие корзины;
- `basket:changed` - обновление интерфейса корзины;
- `order:open` - открытие формы заказа;
- `order:changed` - изменения в заказе;
- `order.address:change` - 
- `/contacts\.(phone|email):change/` - 
- `formErrors:changed` - 
- `order:submit` - подтверджение формы оплаты;
- `contacts:submit` - подтверджение формы контактов;
